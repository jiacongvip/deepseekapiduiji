# 修复总结

## ✅ 修复成功！

### 问题根源

TypeScript 项目（LLM-Red-Team）使用了**自动生成的参数**，而 Python 项目使用**真实的参数**，导致认证失败。

### 关键差异

| 参数 | Python 项目 | TypeScript 项目（修复前） |
|------|------------|------------------------|
| device_id | ✅ 真实值 | ❌ 自动生成 |
| tea_uuid | ✅ 真实值 | ❌ 自动生成 |
| web_id | ✅ 真实值 | ❌ 自动生成 |
| room_id | ✅ 真实值 | ❌ 未使用 |
| x_flow_trace | ✅ 真实值 | ❌ 自动生成 |
| referer | ✅ 包含 room_id | ❌ 固定值 |

### 修复内容

1. ✅ 更新配置文件格式，支持完整参数
2. ✅ 修改 `request()` 函数，使用真实的 device_id、tea_uuid、web_id
3. ✅ 添加 room_id 支持，构建正确的 referer
4. ✅ 使用真实的 x_flow_trace

### 配置格式

```json
{
  "sessionid": {
    "cookie": "完整cookie字符串",
    "device_id": "7586602724335535679",
    "tea_uuid": "7594387748275389952",
    "web_id": "7594387748275389952",
    "room_id": "35716353892568578",
    "x_flow_trace": "04-00022ff2de11a65d001bc9023d8658e9-000725de12b8469a-01"
  }
}
```

### 如何获取参数

从 Python 项目的 `session.json` 中复制，或者：
1. 打开浏览器开发者工具
2. Network 标签页 → 发送消息
3. 找到 `/samantha/chat/completion` 请求
4. 从 URL 参数和 Headers 中提取

### 测试结果

✅ **修复后正常工作！**

---

*修复时间：2026-01-14*
